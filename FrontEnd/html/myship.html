<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My Ship</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet" />
</head>
<body class="bg-light">

<nav class="navbar navbar-expand-lg navbar-dark bg-primary px-3">
    <a class="navbar-brand" href="index.html">Maritime Service</a>
    <div class="ms-auto text-white fw-bold" id="navbarUsername"></div>
</nav>

<div class="container mt-4">
    <h3 class="mb-4">Customer Profile</h3>
    <div id="profileSection" class="card shadow-sm p-3 mb-4"></div>

    <h3 class="mb-3">Requested Services</h3>
    <div id="servicesSection" class="card shadow-sm p-3">
        <table class="table table-striped mb-0">
            <thead>
            <tr>
                <th>Service</th>
                <th>Status</th>
                <th>Requested Date</th>
            </tr>
            </thead>
            <tbody id="servicesTableBody">
            <tr><td colspan="3" class="text-center text-muted">Loading...</td></tr>
            </tbody>
        </table>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script>
    $(document).ready(function () {
        const username = localStorage.getItem("username");

        if (!username) {
            alert("Please sign in to view your account.");
            window.location.href = "index.html";
            return;
        }

        $("#navbarUsername").text(`Welcome, ${username}`);

        // Load customer profile
        $.get(`http://localhost:8080/api/v1/customers/${username}`, function (profile) {
            $("#profileSection").html(`
      <p><strong>Name:</strong> ${profile.name}</p>
      <p><strong>Email:</strong> ${profile.email}</p>
      <p><strong>Phone:</strong> ${profile.phone}</p>
      <p><strong>Address:</strong> ${profile.address}</p>
    `);
        }).fail(function () {
            $("#profileSection").html(`<p class="text-danger">Failed to load profile details.</p>`);
        });

        // Load requested services
        $.get(`http://localhost:8080/api/v1/service-requests/${username}`, function (requests) {
            let rows = "";
            if (requests.length > 0) {
                requests.forEach(req => {
                    rows += `
          <tr>
            <td>${req.serviceName}</td>
            <td>${req.status}</td>
            <td>${new Date(req.requestDate).toLocaleDateString()}</td>
          </tr>
        `;
                });
            } else {
                rows = `<tr><td colspan="3" class="text-center text-muted">No service requests found.</td></tr>`;
            }
            $("#servicesTableBody").html(rows);
        }).fail(function () {
            $("#servicesTableBody").html(`<tr><td colspan="3" class="text-danger text-center">Failed to load service requests.</td></tr>`);
        });
    });
</script>

</body>
</html>
